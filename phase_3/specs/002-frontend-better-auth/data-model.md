# Data Model: Professional Frontend & Better Auth Integration

**Feature**: 002-frontend-better-auth
**Created**: 2026-02-05
**Status**: Draft

## Overview

This document defines the data structures used in the frontend application for authentication and task management. These models align with the backend API contracts defined in Feature 001.

## Entities

### User (Authentication)

Represents an authenticated user in the system. Managed by Better Auth on the frontend and validated via JWT on the backend.

**Source of Truth**: Better Auth session store + Backend database

**Frontend TypeScript Interface**:
```typescript
interface User {
  id: string;              // Unique user identifier (matches JWT "sub" claim)
  email: string;           // User's email address
  name?: string;           // Optional display name
  emailVerified: boolean;  // Email verification status
  createdAt: Date;        // Account creation timestamp
  updatedAt: Date;        // Last profile update timestamp
}
```

**Validation Rules**:
- `email`: Must be valid email format, max 255 characters
- `id`: Generated by Better Auth, immutable
- `emailVerified`: Defaults to false, set to true after email verification

**State Transitions**:
- Unverified → Verified (after email confirmation)
- Active → Deleted (soft delete, not implemented in Phase 2)

**Relationships**:
- One User has many Tasks (one-to-many)

---

### Session

Represents an authenticated user session with JWT token management.

**Source of Truth**: Client-side (HttpOnly cookies or localStorage depending on security model)

**Frontend TypeScript Interface**:
```typescript
interface Session {
  user: User;              // User information
  accessToken: string;     // JWT access token (short-lived: 15-60 min)
  refreshToken?: string;   // JWT refresh token (long-lived: 7-14 days)
  expiresAt: Date;        // Access token expiration timestamp
  issuedAt: Date;         // Token issue timestamp
}

interface AuthState {
  session: Session | null; // Current session or null if unauthenticated
  isLoading: boolean;     // Loading state during auth operations
  error: string | null;   // Error message from failed auth operations
}
```

**Validation Rules**:
- `accessToken`: Must be valid JWT signed with BETTER_AUTH_SECRET
- `expiresAt`: Must be in the future for valid sessions
- Refresh must occur 1 minute before expiration

**State Transitions**:
- Unauthenticated → Authenticated (successful login/signup)
- Authenticated → Refreshing (token near expiration)
- Authenticated → Unauthenticated (logout or token expiration)
- Any state → Error (authentication failure)

---

### Task

Represents a user's task item in the task management system.

**Source of Truth**: Backend database (user-isolated via user_id)

**Frontend TypeScript Interface**:
```typescript
enum TaskStatus {
  PENDING = "pending",
  IN_PROGRESS = "in_progress",
  COMPLETED = "completed"
}

interface Task {
  id: number;                    // Unique task identifier
  title: string;                 // Task title (max 200 chars)
  description: string | null;    // Optional description (max 2000 chars)
  status: TaskStatus;            // Current task status
  user_id: string;               // Owner user ID (for isolation)
  created_at: string;            // ISO 8601 timestamp
  updated_at: string;            // ISO 8601 timestamp
}

// Frontend display model (parsed dates)
interface TaskDisplay extends Omit<Task, 'created_at' | 'updated_at'> {
  created_at: Date;
  updated_at: Date;
}
```

**Validation Rules**:
- `title`: Required, 1-200 characters, no leading/trailing whitespace
- `description`: Optional, max 2000 characters
- `status`: Must be one of TaskStatus enum values
- `user_id`: Set automatically from authenticated session, immutable
- Timestamps: Read-only, managed by backend

**State Transitions**:
```
PENDING → IN_PROGRESS → COMPLETED
   ↓           ↓            ↓
COMPLETED   COMPLETED   PENDING (reset)
```

**Relationships**:
- Many Tasks belong to one User (many-to-one)

---

### Form Models (Client-Side Only)

These models represent form state and validation on the frontend.

#### SignupFormData
```typescript
interface SignupFormData {
  email: string;
  password: string;
  confirmPassword: string;
}

interface SignupFormErrors {
  email?: string;
  password?: string;
  confirmPassword?: string;
  general?: string;  // API errors
}
```

**Validation Rules**:
- `email`: Required, valid email format
- `password`: Required, minimum 8 characters, should include mix of characters
- `confirmPassword`: Must match password exactly

#### LoginFormData
```typescript
interface LoginFormData {
  email: string;
  password: string;
  rememberMe?: boolean;
}

interface LoginFormErrors {
  email?: string;
  password?: string;
  general?: string;  // API errors
}
```

**Validation Rules**:
- `email`: Required, valid email format
- `password`: Required
- `rememberMe`: Optional, extends session duration if true

#### TaskFormData
```typescript
interface TaskFormData {
  title: string;
  description: string;
  status: TaskStatus;
}

interface TaskFormErrors {
  title?: string;
  description?: string;
  status?: string;
  general?: string;  // API errors
}
```

**Validation Rules**:
- `title`: Required, 1-200 characters
- `description`: Optional, max 2000 characters
- `status`: Required, must be valid TaskStatus

---

## UI State Models

### DashboardState
```typescript
interface DashboardState {
  tasks: TaskDisplay[];           // List of tasks for current user
  isLoading: boolean;            // Loading state for initial fetch
  error: string | null;          // Error message if fetch failed
  isEmpty: boolean;              // Computed: tasks.length === 0
  selectedTask: TaskDisplay | null; // Currently selected task for editing
}
```

### TaskListState
```typescript
interface TaskListState {
  filter: TaskStatus | 'all';   // Current filter selection
  sortBy: 'created' | 'updated' | 'title'; // Sort criteria
  sortDirection: 'asc' | 'desc';  // Sort direction
}
```

### NotificationState
```typescript
type NotificationType = 'success' | 'error' | 'warning' | 'info';

interface Notification {
  id: string;                    // Unique notification ID
  type: NotificationType;        // Visual style
  message: string;               // Notification text
  duration?: number;             // Auto-dismiss after ms (null = manual dismiss)
  action?: {
    label: string;
    onClick: () => void;
  };
}

interface NotificationState {
  notifications: Notification[];
}
```

---

## API Request/Response Models

### Authentication API

#### POST /api/auth/signup
**Request**:
```typescript
interface SignupRequest {
  email: string;
  password: string;
}
```

**Response (Success - 201)**:
```typescript
interface SignupResponse {
  user: User;
  session: Session;
}
```

**Response (Error - 400/422)**:
```typescript
interface AuthErrorResponse {
  error: string;
  details?: {
    field: string;
    message: string;
  }[];
}
```

#### POST /api/auth/login
**Request**:
```typescript
interface LoginRequest {
  email: string;
  password: string;
}
```

**Response (Success - 200)**:
```typescript
interface LoginResponse {
  user: User;
  session: Session;
}
```

**Response (Error - 401)**:
```typescript
interface AuthErrorResponse {
  error: string;
}
```

#### POST /api/auth/logout
**Request**: Empty body

**Response (Success - 200)**:
```typescript
interface LogoutResponse {
  success: boolean;
}
```

---

### Task API (Backend Integration)

These models match the FastAPI backend schemas from Feature 001.

#### GET /api/tasks
**Query Parameters**:
```typescript
interface TaskListParams {
  limit?: number;   // Default: 100, range: 1-1000
  offset?: number;  // Default: 0, min: 0
}
```

**Response (Success - 200)**:
```typescript
type TaskListResponse = Task[];
```

#### POST /api/tasks
**Request**:
```typescript
interface TaskCreateRequest {
  title: string;
  description?: string;
  status?: TaskStatus;  // Default: PENDING
}
```

**Response (Success - 201)**:
```typescript
type TaskCreateResponse = Task;
```

#### GET /api/tasks/:id
**Response (Success - 200)**:
```typescript
type TaskGetResponse = Task;
```

**Response (Error - 404)**:
```typescript
interface TaskErrorResponse {
  detail: string;
}
```

#### PUT /api/tasks/:id
**Request**:
```typescript
interface TaskUpdateRequest {
  title?: string;
  description?: string;
  status?: TaskStatus;
}
```

**Response (Success - 200)**:
```typescript
type TaskUpdateResponse = Task;
```

#### DELETE /api/tasks/:id
**Response (Success - 204)**: Empty body

**Response (Error - 404)**:
```typescript
interface TaskErrorResponse {
  detail: string;
}
```

---

## Type Guards and Utilities

```typescript
// Type guard for Task
function isTask(obj: unknown): obj is Task {
  return (
    typeof obj === 'object' &&
    obj !== null &&
    'id' in obj &&
    'title' in obj &&
    'status' in obj &&
    'user_id' in obj
  );
}

// Type guard for Session
function isSession(obj: unknown): obj is Session {
  return (
    typeof obj === 'object' &&
    obj !== null &&
    'user' in obj &&
    'accessToken' in obj &&
    'expiresAt' in obj
  );
}

// Convert backend Task to display Task (parse dates)
function toTaskDisplay(task: Task): TaskDisplay {
  return {
    ...task,
    created_at: new Date(task.created_at),
    updated_at: new Date(task.updated_at),
  };
}

// Validation helper
function validateEmail(email: string): boolean {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email) && email.length <= 255;
}

function validatePassword(password: string): boolean {
  return password.length >= 8;
}

function validateTaskTitle(title: string): boolean {
  const trimmed = title.trim();
  return trimmed.length >= 1 && trimmed.length <= 200;
}
```

---

## Notes

1. **Type Safety**: All models use TypeScript strict mode with no `any` types
2. **Backend Alignment**: Task models match the SQLModel schemas from Feature 001 exactly
3. **Date Handling**: Backend sends ISO 8601 strings, frontend converts to Date objects for display
4. **User Isolation**: All Task operations automatically filtered by user_id on backend
5. **Token Management**: Access tokens stored in memory or HttpOnly cookies, refresh tokens in HttpOnly cookies only
6. **Form State**: Managed separately from API state to enable optimistic updates and validation
7. **Error Handling**: All API responses include error models for proper error display
